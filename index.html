<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Wave</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden;
        }
        #globe-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            cursor: grab; transition: opacity 0.5s ease-in-out;
        }
        #globe-container:active { cursor: grabbing; }
        #info-panel {
            background-color: rgba(17, 24, 39, 0.8); backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        #map-overlay {
            background-color: rgba(0, 0, 0, 0.85); backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px); transition: opacity 0.5s ease-in-out;
        }
        #world-map-svg {
            stroke: #9ca3af; stroke-width: 0.5; max-width: 80%; max-height: 80%;
        }
        #world-map-svg .continent { fill: rgba(31, 41, 55, 0.7); transition: fill 0.3s ease; }
        #world-map-svg .continent:hover { fill: #4f46e5; }
        .draw-line {
            stroke-dasharray: 1000; stroke-dashoffset: 1000;
            animation: draw 2s linear forwards;
        }
        .pulse-dot { animation: pulse 1.5s infinite ease-in-out; transform-origin: center; stroke: none; }
        @keyframes draw { to { stroke-dashoffset: 0; } }
        @keyframes pulse {
            0% { transform: scale(0.8); fill: rgba(255, 165, 0, 0.7); }
            50% { transform: scale(1.2); fill: rgba(255, 165, 0, 1); }
            100% { transform: scale(0.8); fill: rgba(255, 165, 0, 0.7); }
        }

        /* Improved Terminal Styles */
        #terminal-text::-webkit-scrollbar { width: 8px; }
        #terminal-text::-webkit-scrollbar-track { background: transparent; }
        #terminal-text::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        #terminal-text::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        #terminal-text::after {
            content: '█'; color: #d1d5db; /* gray-300 */
            animation: blink 1s step-end infinite; margin-left: 2px;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* Terminal window enter animation */
        #terminal-overlay.active #terminal-window {
            transform: scale(1);
        }

        /* Animated Heading Styles */
        #main-heading span {
            display: inline-block;
            animation: wave 2s infinite ease-in-out;
            animation-delay: var(--delay);
        }
        @keyframes wave {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
    </style>
</head>
<body class="bg-black text-white">

    <div id="sound-toggle" class="absolute top-8 left-8 cursor-pointer z-10">
        <svg id="sound-on-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400 hover:text-white transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
        <svg id="sound-off-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400 hover:text-white transition-colors hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15zM17 14l4-4m0 4l-4-4" /></svg>
    </div>

    <div id="globe-container"></div>

    <div class="absolute top-24 left-1/2 -translate-x-1/2 z-10 text-center pointer-events-none">
        <h1 id="main-heading" class="text-6xl font-bold text-white uppercase" style="text-shadow: 0 0 10px rgba(255,255,255,0.3), 0 0 20px rgba(0,183,255,0.3);">
            Weather Wave
        </h1>
    </div>

    <div class="absolute top-8 left-1/2 -translate-x-1/2 z-10">
        <button id="unlock-button" class="bg-black/20 text-white font-semibold py-3 px-6 rounded-full border border-white/30 backdrop-blur-sm hover:bg-white/10 hover:border-white/50 transition-all duration-300 shadow-lg shadow-black/20">
            Explore Weather
        </button>
    </div>
    
    <div id="info-panel" class="hidden absolute bottom-8 left-8 max-w-sm w-11/12 p-6 rounded-2xl border border-gray-700 shadow-2xl opacity-0 transform translate-y-4">
        <button id="close-button" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
        <h2 id="info-title" class="text-2xl font-bold mb-2"></h2>
        <p id="info-description" class="text-gray-300"></p>
    </div>

    <div id="datetime-display" class="absolute bottom-8 left-1/2 -translate-x-1/2 text-gray-400 text-sm tracking-wider z-10 pointer-events-none"></div>

    <div id="terminal-overlay" class="hidden absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black/50 backdrop-blur-sm z-30 opacity-0 transition-opacity duration-500">
        <div id="terminal-window" class="w-11/12 max-w-4xl h-auto max-h-[80vh] bg-[#1e1e1e] rounded-lg shadow-2xl border border-gray-700 flex flex-col transform scale-95 transition-transform duration-300">
            <div class="bg-gray-700/80 p-3 flex items-center rounded-t-lg">
                <div class="flex space-x-2">
                    <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                    <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                </div>
                <span class="flex-grow text-center text-sm font-sans text-gray-400">zsh — Weather Data Protocol</span>
            </div>
            <pre id="terminal-text" class="text-gray-300 font-mono text-xs md:text-sm p-4 whitespace-pre-wrap flex-grow overflow-y-auto"></pre>
        </div>
    </div>

    <script type="importmap">{ "imports": { "three": "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js", "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/" } }</script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- Basic Scene Setup ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.getElementById('globe-container').appendChild(renderer.domElement);

        // --- Lighting, Textures, and Globe Objects (Earth, Clouds, Stars) ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
        directionalLight.position.set(5, 3, 5);
        scene.add(directionalLight);
        const textureLoader = new THREE.TextureLoader();
        const earthGeometry = new THREE.SphereGeometry(1.5, 64, 64);
        const nightTexture = textureLoader.load('https://unpkg.com/three-globe@2.27.2/example/img/earth-night.jpg');
        const earthMaterial = new THREE.MeshStandardMaterial({
            map: nightTexture,
            bumpMap: textureLoader.load('https://unpkg.com/three-globe@2.27.2/example/img/earth-topology.png'),
            bumpScale: 0.05, metalness: 0.2, roughness: 0.8,
            emissiveMap: nightTexture, emissive: 0xffffff, emissiveIntensity: 1
        });
        const earth = new THREE.Mesh(earthGeometry, earthMaterial);
        scene.add(earth);
        const cloudGeometry = new THREE.SphereGeometry(1.51, 64, 64);
        const cloudMaterial = new THREE.MeshStandardMaterial({
            map: textureLoader.load('https://unpkg.com/three-globe@2.27.2/example/img/earth-clouds.png'),
            transparent: true, opacity: 0.15,
        });
        const clouds = new THREE.Mesh(cloudGeometry, cloudMaterial);
        scene.add(clouds);
        const starGeometry = new THREE.BufferGeometry();
        const starVertices = [];
        for (let i = 0; i < 10000; i++) starVertices.push(THREE.MathUtils.randFloatSpread(200), THREE.MathUtils.randFloatSpread(200), THREE.MathUtils.randFloatSpread(200));
        starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
        const stars = new THREE.Points(starGeometry, new THREE.PointsMaterial({ color: 0xffffff, size: 0.02 }));
        scene.add(stars);

        // --- Camera and Controls ---
        camera.position.z = 3;
        const controls = new OrbitControls(camera, renderer.domElement);
        Object.assign(controls, { enableDamping: true, dampingFactor: 0.05, enablePan: false, minDistance: 2.2, maxDistance: 10, rotateSpeed: 0.4, zoomSpeed: 0.8 });
        
        // --- Hotspots & Interaction ---
        const hotspots = [
            { lat: 28.7041, lon: 77.1025, title: 'New Delhi, India', description: 'The bustling capital of India, a fusion of ancient history and modernity.' },
            { lat: 40.7128, lon: -74.0060, title: 'New York City, USA', description: 'The "Big Apple," a global center for finance, culture, and entertainment.' },
            { lat: -33.8688, lon: 151.2093, title: 'Sydney, Australia', description: 'Famous for its iconic Opera House and Harbour Bridge.' },
        ];
        const hotspotMeshes = [];
        hotspots.forEach(hotspot => {
            const phi = (90 - hotspot.lat) * (Math.PI / 180), theta = (hotspot.lon + 180) * (Math.PI / 180);
            const pos = new THREE.Vector3(-(1.5 * Math.sin(phi) * Math.cos(theta)), (1.5 * Math.cos(phi)), (1.5 * Math.sin(phi) * Math.sin(theta)));
            const mesh = new THREE.Mesh(new THREE.SphereGeometry(0.015, 16, 16), new THREE.MeshBasicMaterial({ color: 0xffa500 }));
            mesh.position.copy(pos);
            mesh.userData = hotspot;
            hotspotMeshes.push(mesh);
            earth.add(mesh);
        });
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        window.addEventListener('click', (event) => {
            if (document.getElementById('terminal-overlay').classList.contains('hidden') === false) return;
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(hotspotMeshes);
            if (intersects.length > 0) showInfoPanel(intersects[0].object.userData.title, intersects[0].object.userData.description);
        });
        
        // --- UI Panel Logic ---
        const infoPanel = document.getElementById('info-panel');
        const showInfoPanel = (title, description) => {
            document.getElementById('info-title').textContent = title;
            document.getElementById('info-description').textContent = description;
            infoPanel.classList.remove('hidden');
            setTimeout(() => infoPanel.classList.remove('opacity-0', 'translate-y-4'), 10);
        };
        document.getElementById('close-button').addEventListener('click', () => {
            infoPanel.classList.add('opacity-0', 'translate-y-4');
            setTimeout(() => infoPanel.classList.add('hidden'), 300);
        });

        // --- Terminal Logic ---
        const unlockButton = document.getElementById('unlock-button');
        const terminalOverlay = document.getElementById('terminal-overlay');
        const terminalText = document.getElementById('terminal-text');

        const startHackingAnimation = () => {
            const lines = [
                { text: 'ssh weather-data@gns-satellite-01.net', prompt: true },
                { text: 'Executing FETCH_WEATHER_GRID.EXE...', prompt: false },
                { text: 'CONNECTING TO GLOBAL DOPPLER RELAY...', prompt: false },
                { text: '<span class="text-green-400">CONNECTION ESTABLISHED. TARGET: PLANET EARTH.</span>', prompt: false },
                { text: 'BYPASSING ATMOSPHERIC INTERFERENCE... <span class="text-green-400">[SUCCESS]</span>', prompt: false },
                { text: 'DECRYPTING FORECAST MODELS... <span class="text-green-400">[SUCCESS]</span>', prompt: false },
                { text: 'ACCESSING CONTINENTAL MAINFRANES:', prompt: false },
                { text: ' &rarr; AFRICA... ACCESSED.', prompt: false },
                { text: ' &rarr; ASIA... ACCESSED.', prompt: false },
                { text: ' &rarr; AUSTRALIA... ACCESSED.', prompt: false },
                { text: ' &rarr; EUROPE... ACCESSED.', prompt: false },
                { text: ' &rarr; NORTH AMERICA... ACCESSED.', prompt: false },
                { text: ' &rarr; SOUTH AMERICA... ACCESSED.', prompt: false },
                { text: ' &rarr; ANTARCTICA... <span class="text-yellow-400">SENSOR OFFLINE. SKIPPING.</span>', prompt: false },
                { text: 'RENDERING GLOBAL WEATHER PATTERNS...', prompt: false },
                { text: '' },
                { text: '<span class="text-teal-400 font-bold">WEATHER DATA FETCHED. REDIRECTING...</span>', prompt: false },
            ];
            let lineIndex = 0;
            terminalText.innerHTML = '';
            terminalOverlay.classList.remove('hidden');
            setTimeout(() => {
                terminalOverlay.classList.remove('opacity-0');
                terminalOverlay.classList.add('active');
            }, 10);

            function typeLine() {
                if (lineIndex < lines.length) {
                    const lineData = lines[lineIndex];
                    let charIndex = 0;
                    const p = document.createElement('p');
                    const promptSpan = document.createElement('span');
                    if (lineData.prompt) {
                        promptSpan.className = 'text-cyan-400';
                        promptSpan.textContent = 'weather-data@satellite:~$ ';
                    } else {
                        promptSpan.className = 'text-gray-500';
                        promptSpan.innerHTML = '&gt; ';
                    }
                    p.appendChild(promptSpan);
                    const textSpan = document.createElement('span');
                    p.appendChild(textSpan);
                    terminalText.appendChild(p);

                    const typingInterval = setInterval(() => {
                        if (charIndex < lineData.text.length) {
                            textSpan.innerHTML = lineData.text.substring(0, charIndex + 1);
                            charIndex++;
                            terminalText.scrollTop = terminalText.scrollHeight;
                        } else {
                            clearInterval(typingInterval);
                            lineIndex++;
                            setTimeout(typeLine, Math.random() * 50 + 20);
                        }
                    }, 20);
                } else {
                    setTimeout(() => {
                        terminalOverlay.classList.remove('active');
                        terminalOverlay.classList.add('opacity-0');
                        // After fade out, redirect to the new link
                        setTimeout(() => { 
                            terminalOverlay.classList.add('hidden'); 
                            // UPDATED: Change this URL to your desired link
                            window.location.href = 'https://nasa-challenge-13.onrender.com/'; 
                        }, 500);
                    }, 1000);
                }
            }
            typeLine();
        };
        unlockButton.addEventListener('click', startHackingAnimation);
        
        // --- Heading Animation ---
        const heading = document.getElementById('main-heading');
        const text = heading.textContent.trim();
        heading.innerHTML = '';
        for (let i = 0; i < text.length; i++) {
            const span = document.createElement('span');
            if (text[i] === ' ') {
                span.innerHTML = '&nbsp;'; // Use non-breaking space for spaces
            } else {
                span.textContent = text[i];
            }
            span.style.setProperty('--delay', `${i * 0.1}s`);
            heading.appendChild(span);
        }

        // --- Other UI Logic (Sound, Time) & Animation Loop ---
        document.getElementById('sound-toggle').addEventListener('click', () => {
            document.getElementById('sound-on-icon').classList.toggle('hidden');
            document.getElementById('sound-off-icon').classList.toggle('hidden');
        });
        const dateTimeDisplay = document.getElementById('datetime-display');
        const updateTime = () => {
            const now = new Date();
            const date = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()}`;
            const time = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
            dateTimeDisplay.textContent = `${date} - ${time}`;
        };
        updateTime();
        setInterval(updateTime, 1000);
        const animate = () => {
            requestAnimationFrame(animate);
            earth.rotation.y += 0.0002;
            clouds.rotation.y += 0.0003;
            stars.rotation.y += 0.0001;
            controls.update();
            renderer.render(scene, camera);
        };
        animate();
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>